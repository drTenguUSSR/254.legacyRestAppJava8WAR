# Технологический стек и принятые решения

## Технологии

- Java: Oracle Java 1.8 x64
- Фреймворки: Spring 5.2.8.RELEASE, Jersey 1.19.4 (JAX-RS реализация)
- Сборка: Gradle 6.8.2 + Groovy
- Тестирование: JUnit 4.12, Jersey Test Framework с Grizzly контейнером
- Основные зависимости:
  - Lombok 1.18.20
  - Google Guava 20.0
  - org.apache.logging.log4j:log4j-api:2.4 + SLF4J
  - Jersey 1.19.4 (jersey-bundle, jersey-json, jersey-spring)
  - JAXB API 2.3.1

## Диагностика и решения

### Анализ JAXB конфигурации

```java
// Используемая реализация: com.sun.xml.internal.bind.v2.runtime.JAXBContextImpl
// JSON обработка через: com.sun.jersey.json.impl.provider.entity.JSONRootElementProvider.App
```

### Регистрация компонентов Jersey 1.x

**Проблема**: Автоматическое сканирование пакетов ненадежно в Jersey 1.x

**Решение**: Явная регистрация через параметры web.xml:

```xml
<!-- Для ContainerRequestFilter -->
<init-param>
    <param-name>com.sun.jersey.spi.container.ContainerRequestFilters</param-name>
    <param-value>
        mil.teng254.legacy.filter.RawRequestLoggingFilter,
        mil.teng254.legacy.filter.SpecialPortFilter
    </param-value>
</init-param>
```

```xml
<!-- Для ContextResolver и других провайдеров -->
<init-param>
    <param-name>com.sun.jersey.config.property.packages</param-name>
    <param-value>
        mil.teng254.legacy.controller,
        mil.teng254.legacy.filter
    </param-value>
</init-param>
```

### Реализованные компоненты

#### RawRequestLoggingFilter

- Назначение: Логирование сырых JSON-запросов для диагностики
- Особенности: Чтение InputStream без IOUtils, продолжение обработки при
ошибках логирования
- Регистрация: Через `ContainerRequestFilters`

#### JAXBContentResolver

- Назначение: Кастомный ContextResolver для JAXB с автоопределением DTO классов
- Автосканирование: Использует `AnnotationScannerListener` и
`PackageNamesScanner` для поиска классов с `@XmlRootElement`
- Регистрация: Через сканирование пакетов (`@Provider` аннотация)

### Интеграционное тестирование

- Использование `GrizzlyWebTestContainerFactory` для поддержки сервлетов
- Конфигурация Spring контекста через `@ContextConfiguration`
- Явная регистрация фильтров в методе `configure()` тестового класса

## Ключевые выводы для будущих доработок

1. **Jersey 1.x требует явной регистрации** компонентов через параметры конфигурации
2. **Автоматическое сканирование ненадежно** - предпочтительна явная регистрация
3. **JAXB + JSON в Jersey 1.x** работает через JAXB-based провайдер (не Jackson)
4. **ContainerRequestFilter** и **ContextResolver** регистрируются разными параметрами
5. **Интеграционные тесты** требуют той же конфигурации, что и основное приложение

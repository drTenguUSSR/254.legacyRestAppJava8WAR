# 02.main-generator-prompt.md

Создать проект веб-приложения на java:
- базовый пакет для всего кода - mil.teng254.legacy
- Oracle Java 1.8 x64
- Gradle 6.8.2 + groovy
- Spring 5.2.8.Release
- SpringBoot не применяется
- используется Thymeleaf
- Jersey 1.19.4 как реализация JAX-RS (JSR 311). зависимость com.sun.jersey:jersey-bundle:1.19.4
- Google Guava 20.0
- Junit 4.12
- Log4j 1.2.14 + xml конфигурация
- Lombok 1.18.20
- в web.xml параметр com.sun.jersey.api.json.POJOMappingFeature выключен (false)
- сериализация JSON через JAXB
- используй SpringServlet для автоматической регистрации компонентов и провайдеров.
- параметры контролеров обернуты в JAXBElement
- контролеры аннотированы @Consumes(MediaType.APPLICATION_JSON)
  и @Produces(MediaType.APPLICATION_JSON)
- контролеры возвращают тип javax.ws.rs.core.Response;
- результат сборки - ROOT.war

## Требования к функциям приложения:
- контролеры описываются и @RestController и @Path
- контролер POST /public/hello-path:\
  аннотирован @Path\
  принимает json:
```json
{"key": 100, "stamp":"2025-06-20T11:24:36Z"}
``` 
, где\
stamp - дата-время в формате ISO 8601\
возвращает json:
```
{"res: 101, "stamp":"2025-06-20T10:24:36Z", "tz":"+03:00"}
```
,где\
101 - инкрементированное значение key типа long\
"stamp" - время, полученное из запроса, увеличенное на 1 час\
"tz" - временная зона сервера в виде смещения\
- контролер POST /public/hello-rest:
  аннотирован @RestController
  принимает json {"key": 100, "stamp":"2025-06-20T11:24:36Z"}
  stamp - дата-время в формате ISO 8601
  возвращает json {"res: 101, "stamp":"2025-06-20T10:24:36Z", "tz":"+03:00"}
  101 - инкрементированное значение key типа long
  "stamp" - время, полученное из запроса, увеличенное на 1 час
  "tz" - временная зона сервера в виде смещения
- контролер POST /special/mark-path обрабатывает запросы только на 8082 порту:
  аннотирован @Path
  принимает json {"key": 100, "stamp":"2025-06-20T11:24:36Z"}
  stamp - дата-время в формате ISO 8601
  возвращает json {"res: 101, "stamp":"2025-06-20T10:24:36Z", "tz":"+03:00"}
  101 - инкрементированное значение key типа long
  "stamp" - время, полученное из запроса, увеличенное на 1 час
  "tz" - временная зона сервера в виде смещения
- для ограничения порта обработки /special/mark-path
  ввести новую аннотацию
  @SpecialPort которая работает так:
  если запрос приходит на порт отличный от указанного в аннотации параметра,
  запрос отвергается. вариант реализации - http-фильтр
- номер специального порта задается в переменной окружения SPECIAL_PORT.
Если переменная отсутствует или имеет недопустимое значение - приложение падает при старте.
Если переменная имеет допустимое значение - контролер с аннотацией @SpecialPort.
Если переменная имеет значение -1, то приложение стартует, но запросы на контролер
с аннотацией @SpecialPort должны отвергаться

Далее отдельно описать multistage сборку проекта
при этом используется:
- Oracle Java 1.8
- Apache Tomcat 8.5.63
- в Tomcat используется нестандартный concf/server.xml:
приложение прослушивает два порта HTTP 8081 и порт, указанные в
переменной среды SPECIAL_PORT

Привести пример запуска собранного докера с возможностью изменить
SPECIAL_PORT в момент запуска образа.